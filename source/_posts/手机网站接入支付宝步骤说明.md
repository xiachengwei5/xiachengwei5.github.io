---
title: 手机网站接入支付宝步骤说明
date: 2018-05-20 17:20:00
tags: [支付宝, Alipay, H5]
---
## 1 文档介绍

### 1.1 文档目的

本文档主要说明通过手机网站（H5）接入支付宝的支付功能，因支付宝官方已经有比较详细的文档，本文档仅对主要操作步骤以及相关的代码开发进行说明，具体操作步骤还需要参考查看支付宝官方文档。

本文档适用于协助项目经理、开发人员熟悉手机网站接入支付宝支付功能的流程和具体操作。

主要参考文档-手机网站支付产品介绍：<https://docs.open.alipay.com/203/>。
<!-- more -->
## 2 手机网站支付宝接入所需要的资料

1. 经过实名认证的支付宝帐号、登录密码和支付密码；（这里的支付宝帐号一般是经过认证的商户号）

2. 生产环境可以正常访问的域名网址；（用于申请接入手机网站支付）

3. 应用的APPID；（创建应用时会自动生成）

4. 支付宝公钥；（由“RSA签名验签工具”生成的应用公钥保存后自动生成）

5. 与应用公钥匹配的私钥；（由“RSA签名验签工具”生成）

## 3 应用接入

网页&APP应用接入详细说明文档请查看：<https://docs.open.alipay.com/399/>，下面只展示重要步骤。

应用是开发者以软件形式向用户提供的特定场景或行业解决方案。具备开发能力的服务商入驻开放平台后，需要通过创建应用的方式接入蚂蚁各项产品（如当面付、开店、发券、服务窗、余利宝等）接口并进行开发，基于对行业及业务场景痛点的理解，创造能够满足市场需要的解决方案，以应用的形式服务用户，应用从申请到运营的流程如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_1.png)

### 3.1 选择开发角色

点击“开放平台”或直接访问<https://open.alipay.com>，登录成功后进入“我的开放平台”，角色选择“自研开发者”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_2.png) 

按照要求完善相关信息并签署协议，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_3.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_4.png) 

### 3.2 创建应用

鼠标移到“开发者中心”选择“网页&移动应用”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_5.png) 

根据实际情况选择创建应用的目的，因为是要接入支付，点击下面的“支付接入”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_6.png) 

因为是以券商的名义申请，所以此处选择“自用型应用”，输入应用名称，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_7.png) 

应用创建成功后会自动分配APPID，因为是通过H5支付，此处需要签约“手机网站支付”功能，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_8.png) 

### 3.3 接入手机网站支付

点击“手机网站支付”或直接访问<https://b.alipay.com>，选择“手机网站支付”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_9.png) 

确保满足申请条件，点击“立即接入”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_10.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_11.png) 

签约成功后可以在“产品中心”查看已经签约成功的产品信息，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_12.png) 

### 3.4 开发配置

主要配置的“接口加签方式”，该部分的内容比较绕，需要重点注意公钥、私钥的获取方式和验证方式，点击“设置应用公钥”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_13.png) 

点击“设置应用公钥”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_14.png) 

点击“查看密钥生成方法”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_15.png) 

下载对应系统的密钥生成工具（文档地址：<https://docs.open.alipay.com/291/105971>），下载完成打开程序，选择“生成密钥”，密钥格式选择“PKCS8(JAVA适用)”，密钥长度选择“2048”，点击“生成密钥”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_16.png) 

生成的私钥后续会直接配置在代码或配置文件中，生成的公钥即上面需要配置的“应用公钥”，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_17.png) 

点击“验证公钥正确性”可以验证生成的的公钥和私钥是否匹配，只有完全匹配才能对接成功，点击“下载”签名工具，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_18.png) 

打开下载的签名工具，将之前生成的私钥复制到左边，点击“生成签名”即可生成签名，将生成的签名，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_19.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_20.png) 

应用公钥保存后会自动生成“支付宝公钥”，该支付宝公钥后续会配置在代码或配置文件中，点击查看，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_21.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_22.png) 

### 3.5 提交审核

在经过上述一系列操作之后，已经获得了手机网站支付宝接入所需要的所有资料，在确认无误后，点击“提交审核”进行审核，审核需要一个工作日，审核通过后就能正常使用了，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_23.png) 

 

## 4 沙箱环境

蚂蚁沙箱环境(Beta)是协助开发者进行接口功能开发及主要功能联调的辅助环境。沙箱环境模拟了开放平台部分产品的主要功能和主要逻辑。文档地址：<https://docs.open.alipay.com/200/105311/>，进入沙箱环境操作如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_24.png) 

沙箱环境的应用不需要申请已经自动分配，“设置应用公钥”的方式跟正式应用一样，在此不在赘述，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_25.png) 

另外，沙箱环境已经提供了沙箱帐号（包含：商家信息和买家信息），在沙箱环境进行支付时需要登录买家帐号进行支付，在商家帐号中就可以看到支付情况，如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_26.png) 

在沙箱环境需要通过沙箱版支付宝客户端进行支付，在沙箱环境唤起正式版支付宝会进行支付会提示失败，沙箱版支付宝目前仅支持Android版，下载地址如下图：

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_27.png) 

## 5 开发代码

### 5.1 Java开发

后台部分主要负责请求支付宝支付接口，以及支付完成后支付回调的处理部分。建立支付宝链接的公共参数如请求网关，公钥，私钥等信息建议配置在配置文件中，方便后期修改。具体代码可以参考支付宝demo

下载链接:<https://docs.open.alipay.com/203/105910/>

#### 5.1.1 引入支付宝SDK

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_28.png) 

#### 5.1.2 配置支付宝参数

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_29.png) 

**注意**: 

1. ALIPAY_PUBLIC_KEY是支付宝生成的支付宝公钥；
2. return_url，notify_url必须是外网可以直接访问的地址；

#### 5.1.3 支付宝请求和回调

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_30.png) 

 

 支付宝回调信息建议在jsp中进行处理，一方面方便数据处理，另一方面回调页面要求固定格式。按照官方文档，回调验证以异步回调为主。

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_31.png) 

 

### 5.2 手机网站支付唤起支付宝app

商家在网页中调用支付宝提供的网页支付接口调起支付宝客户端内的支付模块，商家网页会跳转到支付宝中完成支付，支付完后跳回到商家网页内，最后展示支付结果。若无法唤起支付宝客户端，则在一定的时间后会自动进入网页支付流程。

要实现唤起支付宝app的功能需要原生app做对应调整（文档地址：<https://docs.open.alipay.com/203/107091/>），具体调整内容如下：

#### 5.2.1 Android端代码调整

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_32.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_33.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_34.png)

#### 5.2.2 IOS端代码调整

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_35.png) 

![img](http://olywxnzqu.bkt.clouddn.com/image/alipay/alipay_36.png)

 