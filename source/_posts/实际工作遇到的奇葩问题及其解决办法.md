---
title: 实际工作遇到的奇葩问题及其解决办法
data: 2018-03-06
tags: [linux, spring boot, 文件上传]
---

#### 一、在linux系统中使用spring boot的服务器长时间不重启导致上传文件的功能不能使用

上传的文件抛出的异常为：`IOException: The temporary upload location [/tmp/tomcat.3814974221022613431.8080/work/Tomcat/localhost/ROOT] is not valid` 

**产生原因：** 

> * spring boot的应用服务在启动的时候，会生成在操作系统的/tmp目录下生成一个Tomcat.*的文件目录，用于"java.io.tmpdir"文件流操作；
> * 程序对文件的操作时：会生成临时文件，暂存在临时文件中；lunix 系统的tmpwatch 命令会删除10天未使用的临时文件；长时间不操作，导致/tmp下面的tomcat临时文件目录被删除，且删除的文件不可恢复，上传文件时获取不到文件目录所以报错；

**解决办法：** 

> * 重启服务，临时方案：会重新生成tomcat目录，但是生产环境不建议如此操作；
>
> * 修改tmpwatch 删除文件的逻辑，系统级别的命令，不建议操作；
>
> * 启动时增加参数设置自定义目录（推荐），配置命令如下：
>
>   `-Djava.io.tmpdir=自定义目录` 
>
>   如在启动`jar` 包时添加配置，如下：
>
>   ``` sh
>   nohup java -Djava.io.tmpdir=/home/xiacw/app/tomocat-tmp -jar pms-govern.jar -Xms256m -Xmx512m -Xss256k
>   ```

**参考资料：**

[spring boot 上传文件出错:java.io.IOException: The temporary upload location](http://blog.csdn.net/m386084855/article/details/79041621) 